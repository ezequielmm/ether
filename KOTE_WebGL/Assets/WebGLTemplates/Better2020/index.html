<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>{{{ PRODUCT_NAME }}}</title>
    <link rel="shortcut icon" href="TemplateData/favicon.ico">
    <link rel="stylesheet" href="TemplateData/style.css">
  </head>
  <body class="{{{ SPLASH_SCREEN_STYLE.toLowerCase() }}}">
    <div id="productVersion">
      <p>{{{ PRODUCT_VERSION }}}</p>
    </div>
    <div id="unity-container" class="unity-desktop">
      <canvas id="unity-canvas"></canvas>
    </div>
    <div id="unity-fullscreen-button" style="display: none;"></div>
    <div id="progress-container">
      <img id="loading-logo" src="logo.png" alt="Knights Of The Ether Logo">
      <div id="progress-bar-border">
        <div id="progress-bar"></div>
      </div>
    </div>
    <script>
      const hideFullScreenButton = "{{{ HIDE_FULL_SCREEN_BUTTON }}}";
      const buildUrl = "Build";
      const loaderUrl = buildUrl + "/{{{ LOADER_FILENAME }}}";
      const config = {
        dataUrl: buildUrl + "/{{{ DATA_FILENAME }}}",
        frameworkUrl: buildUrl + "/{{{ FRAMEWORK_FILENAME }}}",
        codeUrl: buildUrl + "/{{{ CODE_FILENAME }}}",
#if MEMORY_FILENAME
        memoryUrl: buildUrl + "/{{{ MEMORY_FILENAME }}}",
#endif
#if SYMBOLS_FILENAME
        symbolsUrl: buildUrl + "/{{{ SYMBOLS_FILENAME }}}",
#endif
        streamingAssetsUrl: "StreamingAssets",
        companyName: "{{{ COMPANY_NAME }}}",
        productName: "{{{ PRODUCT_NAME }}}",
        productVersion: "{{{ PRODUCT_VERSION }}}",
      };

      const container = document.querySelector("#unity-container");
      const canvas = document.querySelector("#unity-canvas");
      const fullscreenButton = document.querySelector("#unity-fullscreen-button");
      const progressBar = document.querySelector("#progress-bar");
      const progressContainer = document.querySelector("#progress-container");

      const canFullscreen = (function() {
        for (const key of [
            'exitFullscreen',
            'webkitExitFullscreen',
            'webkitCancelFullScreen',
            'mozCancelFullScreen',
            'msExitFullscreen',
          ]) {
          if (key in document) {
            return true;
          }
        }
        return false;
      }());

      if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
        container.className = "unity-mobile";
        config.devicePixelRatio = 1;
      }
#if BACKGROUND_FILENAME
      canvas.style.background = "url('" + buildUrl + "/{{{ BACKGROUND_FILENAME.replace(/'/g, '%27') }}}') center / cover";
#endif

      // The Unity Instance
      var unity;
      
      const script = document.createElement("script");
      script.src = loaderUrl;
      script.onload = () => {
        progressContainer.style.display = '';
        container.style.display = 'none';
        createUnityInstance(canvas, config, UnityProgress).then(UnityLoaded)
        .catch((message) => {
          alert(message);
        });
      }
      document.body.appendChild(script);

      function UnityProgress(progress) 
      {
        progressBar.style.width = (progress * 100) + "%"
      }
      function UnityLoaded(unityInstance) {
        progressContainer.style.display = 'none';
        container.style.display = '';
        unity = unityInstance;
        if (canFullscreen) {
          if (!hideFullScreenButton) {
            fullscreenButton.style.display = "";
          }
          fullscreenButton.onclick = () => {
            unityInstance.SetFullscreen(1);
          };
        }
      }
      function AfkCheck() {
          document.onmousemove = SendAfkUpdate;
          document.onkeydown = SendAfkUpdate;
          document.onmousedown = SendAfkUpdate;
          document.onclick = SendAfkUpdate;
          function SendAfkUpdate() {
              if (unity != null) {
                  unity.SendMessage("UserActivityMonitor", "GetMessageFromJs");
              }
          }
      }
      AfkCheck();
      
      if(typeof window.ethereum !== 'undefined') {
        ethereum.on('accountsChanged', function (accounts) {
          if(unity != null) {
            unity.SendMessage("MetaMask", "AccountChanged", JSON.stringify(accounts))
          }
        })
      }
    </script>
  </body>
</html>
