<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>{{{ PRODUCT_NAME }}}</title>
    <link rel="shortcut icon" href="TemplateData/favicon.ico">
    <link rel="stylesheet" href="TemplateData/style.css">
  </head>
  <body class="{{{ SPLASH_SCREEN_STYLE.toLowerCase() }}}">
    <div id="unity-container" class="unity-desktop">
      <canvas id="unity-canvas"></canvas>
    </div>
    <div id="unity-fullscreen-button" style="display: none;"></div>
    <div id="progress-container">
      <div id="productVersion">
        <p>{{{ PRODUCT_VERSION }}}</p>
      </div>
      <img id="loading-logo" src="logo.png" alt="Knights Of The Ether Logo">
      <div id="progress-bar-border">
        <div id="progress-bar"></div>
      </div>
      <br>
      <div style="font-family: Copperplate, Papyrus, fantasy; width: 50%; text-align: center; font-weight: bold">
        Welcome, Traveler. You’ve found Knights of the Ether, you should be proud.
        <br>The game you are about to play goes
        by the name of Blightfell, this is our prototype that we have been building for 14 months and it is currently in
        Early Access.
        <br>
        <br>
        What does this mean?
        <br>
        <br>
        It means that the first time you load up our game you’ll experience a long loading time, anywhere from 30
        seconds up to 5 minutes. Don’t be alarmed. This only happens the very first time you play our game. All future
        load-ins are near instantaneous!
        <br>
        <br>
        It means that this is just a small slice of the full gaming experience we have planned for you. As of now we
        have only 1 of 3 stages available to compete in, The Fen. If you’re interested in learning more about future
        content, join us in Discord for the full details at https://discord.gg/kote
        <br>
        <br>
        It means that you may find a bug or two during your expeditions, that’s ok. If you do stumble upon one and would
        like to help us do a better job of fixing it, you can click the ‘Submit Feedback’ button in the settings menu
        and give us a bit of information, we’d appreciate it, but no worries if you’re moving fast and trying to beat
        those timed top scores!
        <br>
        <br>
        With that out of the way, we can safely say it’s time to focus on the most important thing…
        <br>
        <br>
        Have fun! …and hey, maybe earn a little bit of coin in the process.
        We’re rooting for you out there.
        <br>
        <br>
        The Knights of the Ether Team
        <br>
        <br>
        P.S. Beware the Blight
      </div>
    </div>
    <script>
      const hideFullScreenButton = "{{{ HIDE_FULL_SCREEN_BUTTON }}}";
      const buildUrl = "Build";
      const discriminatorQuery = "?v=" + encodeURIComponent("{{{ PRODUCT_VERSION }}}");
      const loaderUrl = buildUrl + "/{{{ LOADER_FILENAME }}}" + discriminatorQuery;
      const config = {
        dataUrl: buildUrl + "/{{{ DATA_FILENAME }}}" + discriminatorQuery,
        frameworkUrl: buildUrl + "/{{{ FRAMEWORK_FILENAME }}}" + discriminatorQuery,
        codeUrl: buildUrl + "/{{{ CODE_FILENAME }}}" + discriminatorQuery,
#if MEMORY_FILENAME
        memoryUrl: buildUrl + "/{{{ MEMORY_FILENAME }}}" + discriminatorQuery,
#endif
#if SYMBOLS_FILENAME
        symbolsUrl: buildUrl + "/{{{ SYMBOLS_FILENAME }}}" + discriminatorQuery,
#endif
        streamingAssetsUrl: "StreamingAssets",
        companyName: "{{{ COMPANY_NAME }}}",
        productName: "{{{ PRODUCT_NAME }}}",
        productVersion: "{{{ PRODUCT_VERSION }}}",
      };

      const container = document.querySelector("#unity-container");
      const canvas = document.querySelector("#unity-canvas");
      const fullscreenButton = document.querySelector("#unity-fullscreen-button");
      const progressBar = document.querySelector("#progress-bar");
      const progressContainer = document.querySelector("#progress-container");

      const canFullscreen = (function() {
        for (const key of [
            'exitFullscreen',
            'webkitExitFullscreen',
            'webkitCancelFullScreen',
            'mozCancelFullScreen',
            'msExitFullscreen',
          ]) {
          if (key in document) {
            return true;
          }
        }
        return false;
      }());

      if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
        container.className = "unity-mobile";
        config.devicePixelRatio = 1;
      }
#if BACKGROUND_FILENAME
      canvas.style.background = "url('" + buildUrl + "/{{{ BACKGROUND_FILENAME.replace(/'/g, '%27') }}}') center / cover";
#endif

      // The Unity Instance
      var unity;
      
      const script = document.createElement("script");
      script.src = loaderUrl;
      script.onload = () => {
        progressContainer.style.display = '';
        container.style.display = 'none';
        createUnityInstance(canvas, config, UnityProgress).then(UnityLoaded)
        .catch((message) => {
          alert(message);
        });
      }
      document.body.appendChild(script);

      function UnityProgress(progress) 
      {
        progressBar.style.width = (progress * 100) + "%"
      }
      function UnityLoaded(unityInstance) {
        progressContainer.style.display = 'none';
        container.style.display = '';
        unity = unityInstance;
        if (canFullscreen) {
          if (!hideFullScreenButton) {
            fullscreenButton.style.display = "";
          }
          fullscreenButton.onclick = () => {
            unityInstance.SetFullscreen(1);
          };
        }
      }
      function AfkCheck() {
          document.onmousemove = SendAfkUpdate;
          document.onkeydown = SendAfkUpdate;
          document.onmousedown = SendAfkUpdate;
          document.onclick = SendAfkUpdate;
          function SendAfkUpdate() {
              if (unity != null) {
                  unity.SendMessage("UserActivityMonitor", "GetMessageFromJs");
              }
          }
      }
      AfkCheck();
      
      if(typeof window.ethereum !== 'undefined') {
        ethereum.on('accountsChanged', function (accounts) {
          if(unity != null) {
            unity.SendMessage("MetaMask", "AccountChanged", JSON.stringify(accounts))
          }
        })
      }
    </script>
  </body>
</html>
